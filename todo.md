# NewsSkins TODO

## 緑急: mutation呼び出し修正

- [x] Home.tsxのmutation呼び出しを正しい構造に修正（extractedとparamsを正しく送信）
- [x] 開発環境で動作確認（エラー消失）
- [ ] チェックポイント作成

## 緑急: 変換結果が空白で表示される問題の修正

### Phase 1: Gemini APIレスポンス構造の調査
- [x] Google Generative AI SDKの公式ドキュメントを確認
- [x] `response.text()` が存在するか確認
- [x] 正しいレスポンス構造（`response.text` プロパティ）を特定

### Phase 2: Gemini APIレスポンス構造の修正
- [x] @google/generative-aiから@google/genaiにパッケージを変更
- [x] transform.tsの `response.text()` を `response.text` プロパティに修正
- [x] systemInstructionをconfigの中に移動
- [x] エラーハンドリングを強化（レスポンスが空の場合の処理）
- [x] デバッグログを追加して実際のレスポンス構造を確認

### Phase 3: UIをシンプル化（URL・タイトル削除）
- [x] Home.tsxから記事URL入力欄を削除
- [x] Home.tsxから記事タイトル入力欄を削除
- [x] transform APIのリクエスト構造を変更（url, title, site, langを任意に）
- [x] Reader.tsxから元記事URLリンクを削除

### Phase 4: NEWSSKINSクレジット表示を追加
- [x] transform.tsで出力結果の最後に「\n\n[NEWSSKINS]」を追加
- [x] Reader.tsxでSource URL表示を完全に削除

### Phase 5: テストとチェックポイント作成
- [x] transform.test.tsを更新して新しいAPI構造をテスト
- [x] すべてのテストが通ることを確認
- [ ] ブラウザで実際に変換をテストして動作確認
- [ ] 複数のスキンで変換結果が正しく表示されるか確認
- [ ] チェックポイント作成

## 完了済み機能
- [x] データベーススキーマ設計（履歴、プリセット、設定テーブル）
- [x] 基本的なtRPCルーター構造の構築
- [x] 記事抽出機能の実装（Readability系）
- [x] Gemini 2.5 Flash API統合
- [x] Source URL必須バリデーション
- [x] 基本的な変換APIエンドポイント
- [x] 10種スキン定義とプロンプト設計
- [x] パラメータ調整UI（温度、Top-p、出力長、要約率など）
- [x] スキン選択UI
- [x] 変換結果表示UI（Reader画面）
- [x] 原文プレビュートグル機能
- [x] PWA設定（Service Worker、Share Target、manifest.json）
- [x] オフライン対応
- [x] Vitestテスト作成
- [x] 元記事URLを必須から任意項目に変更（*マークを削除）
- [x] URLが未入力の場合、Source表示と「元記事を開く」ボタンを非表示
- [x] ガイドページコンポーネントを作成（/guide）
- [x] 詳細設定の各パラメータを分かりやすく説明
- [x] 各スキンの特徴と使い方を説明
- [x] 実例を交えた使い方ガイド
- [x] 変換結果のURL共有機能（24時間有効な署名URL）
- [x] ShareLinksテーブルへの保存機能
- [x] 共有URLからの閲覧機能（/share/:id）
- [x] テキストコピー機能の改善
- [x] 変換結果をtransformHistoryテーブルに保存
- [x] 履歴一覧ページで過去の変換結果を表示
- [x] 設定ページでAPIキーを保存する機能
- [x] userSettingsテーブルへの暗号化保存
- [x] HomeページでAPIキーを自動入力
- [x] settings.get APIがundefinedを返すエラーを修正
- [x] 設定が存在しない場合はデフォルト値を返すように変更
- [x] Reader.tsxの「Rendered more hooks than during the previous render」エラーを修正
- [x] 条件分岐の中でフックを呼び出さないようにコードを修正

## スキン品質改善タスク

### Phase 1: テスト記事を準備してGemini APIで変換テストを実行
- [x] テスト用の記事サンプルを準備
- [x] Gemini APIキーを使って実際に変換テストを実行
- [x] 変換結果が正しく表示されるか確認
- [x] response.textの取得方法を修正
- [x] gemini-2.0-flashにモデルを変更して内部思考トークンの問題を解決

### Phase 2: 複数のスキン（関西ノリ風、冷めた文学風など）で変換品質を評価
- [x] 関西ノリ風スキンで変換して品質を評価
- [x] 冷めた文学風スキンで変換して品質を評価
- [x] その他のスキン（おじさんメール風、詩的エモ風など）でも変換テスト
- [x] 各スキンの問題点や改善点をリストアップ
- [x] skin-quality-analysis.mdに詳細な分析レポートを作成

### Phase 3: 改善点を特定してスキン定義やプロンプトを調整
- [x] 関西ノリ風のfewShotsを1つから3つに増やしました
- [x] おじさん構文風のfewShotsを1つから2つに増やしました
- [x] 詩的エモ風のfewShotsを1つから2つに増やしました
- [x] スキン定義のrulesとdoListをより具体的に修正
- [x] 改善後のテストでA-B-A'構造が明確になったことを確認

### Phase 4: 改善後の変換結果を確認してチェックポイント作成
- [x] 改善後の変換結果を確認
- [x] すべてのスキンで品質が向上したか検証
- [ ] チェックポイント作成

## タイトル変更とGitHubプッシュ

- [x] タイトルを「NEWSSKINS」から「言い換えメーカー」に変更
- [x] manifest.jsonのアプリ名を変更
- [x] vite.config.tsのアプリ名を変更
- [x] client/index.htmlのタイトルを変更
- [x] Home.tsx, Guide.tsx, Share.tsxのタイトルを変更
- [x] チェックポイント作成
- [x] GitHubに新規リポジトリを作成 (https://github.com/kojima1459/iikae-maker)
- [x] コードをGitHubにプッシュ
- [x] コードをZIPで送付 (iikae-maker.zip, 295KB)

## フィードバック機能の実装

### Phase 1: データベース設計案を作成
- [x] フィードバックテーブルの設計
- [x] 分析用のビューやクエリの設計
- [x] 設計ドキュメントの作成 (feedback-database-design.md)

### Phase 2: データベーススキーマを実装
- [x] feedbackテーブルをschema.tsに追加
- [x] マイグレーションを実行（pnpm db:push）
- [x] データベース接続を確認

### Phase 3: フィードバック機能のAPIを実装
- [x] feedback.submit APIを実装（フィードバック送信）
- [x] feedback.stats APIを実装（統計情報取得）
- [x] feedback.list APIを実装（フィードバック一覧取得）
- [x] db.tsにsubmitFeedback, getFeedbackStats, getFeedbackListを追加
- [x] routers.tsにfeedbackルーターを追加

### Phase 4: フィードバックUIを実装
- [ ] Reader.tsxに「良い」「悪い」ボタンを追加
- [ ] フィードバック送信後のトースト通知を実装
- [ ] フィードバック済みの状態管理を実装

### Phase 5: 分析ダッシュボードを実装
- [ ] 管理者用の分析ページを作成
- [ ] スキン別の評価統計を表示
- [ ] 評価が低いスキンをハイライト表示

### Phase 6: テストとチェックポイント作成
- [ ] フィードバック機能のテストを実行
- [ ] チェックポイント作成

## スキンを面白おかしく改善

### Phase 1: 現在のスキンを分析して改善点を特定
- [x] 各スキンの現在の特徴を分析
- [x] より笑えるようにするための改善点をリスト化
- [x] skin-humor-improvement-plan.mdに詳細な改善計画を作成

### Phase 2: 全スキンをより面白く、笑えるように改善
- [x] 関西ノリ風をより笑えるように改善（誇張表現、具体的な比喩）
- [x] おじさん構文風をより笑えるように改善（不要な自分語り、謎のカタカナ語）
- [x] 詩的エモ風をより笑えるように改善（シュールな擬人化、過剰なポエム）
- [x] デタッチ文学風をより笑えるように改善（非論理的な比喩、唐突な日常描写）
- [x] 意味深セーフ大人風をより笑えるように改善（二重の意味、「...」の活用）

### Phase 3: 改善後のスキンでテストを実行
- [x] Gemini APIで変換テストを実行
- [x] 笢えるかどうかを評価
- [x] おじさん構文風が非常に笑えることを確認（⭐⭐⭐⭐⭐）
- [x] 詩的エモ風がシュールで面白いことを確認（⭐⭐⭐⭐）
- [x] skin-humor-test-results.mdにテスト結果を記録

### Phase 4: チェックポイント作成
- [x] チェックポイント作成 (version: 80299689)

## 新しいスキンの追加

### Phase 1: 新しいスキンの定義を作成
- [x] 若者言葉風（Z世代）のスキン定義を作成
- [x] ラップ風のスキン定義を作成
- [x] 学術論文風のスキン定義を作成
- [x] new-skins-definition.mdに詳細な定義を記録

### Phase 2: skins.tsに3つのスキンを追加
- [x] skins.tsに若者言葉風（Z世代）を追加
- [x] skins.tsにラップ風を追加
- [x] skins.tsに学術論文風を追加

### Phase 3: Gemini APIでテストを実行
- [x] 3つの新しいスキンでGemini APIテストを実行
- [x] 変換品質を評価
- [x] 若者言葉風（Z世代）が非常に良い（⭐⭐⭐⭐⭐）
- [x] ラップ風が非常に良い（⭐⭐⭐⭐⭐）
- [x] 学術論文風が良い（⭐⭐⭐⭐）
- [x] new-skins-test-results.mdにテスト結果を記録

### Phase 4: チェックポイント作成とGitHubプッシュ
- [x] チェックポイント作成 (version: 73585a5f)
- [x] GitHubにプッシュ

## UI改善と新機能の実装

### Phase 1: 記事本文の文字数上限を確認して必要に応じて調整
- [x] 現在の文字数上限を確認（上限なし）
- [x] 最大5000文字、最大10000文字の制限を追加
- [x] 文字数カウンターと警告表示を追加

### Phase 2: スキン選択をカード形式にUI改善
- [x] スキン選択UIをカード形式に変更
- [x] 各スキンの特徴を視覚的に表示（グリッドレイアウト）

### Phase 3: TwitterとLINEで共有できるボタンを追加
- [x] Reader.tsxにTwitter共有ボタンを追加
- [x] Reader.tsxにLINE共有ボタンを追加
- [x] 共有テキストのフォーマットを作成

### Phase 4: お気に入りスキン機能を実装
- [x] お気に入りスキンのデータベーススキーマを追加 (favorite_skinsテーブル)
- [x] お気に入りスキンのAPIを実装 (favorites.list/add/remove/check)
- [x] お気に入りスキンのUIを実装 (星アイコンボタン)

### Phase 5: テストとチェックポイント作成
- [x] お気に入りスキン機能のテストを作成して実行 (6/6テスト成功)
- [x] チェックポイント作成 (version: 74ea40ef)

## 多言語展開（日本語、中国語、英語）

### Phase 1: 多言語対応の設計と翻訳ファイル作成
- [x] i18n（国際化）ライブラリを選定してインストール (i18next, react-i18next)
- [x] 翻訳ファイル構造を設計（日本語、中国語、英語）
- [x] 各言語の翻訳ファイルを作成 (client/src/i18n.ts)

### Phase 2: 言語切り替え機能を実装
- [x] 言語切り替えボタンをヘッダーに追加 (LanguageSwitcherコンポーネント)
- [x] 言語設定をローカルストレージに保存 (i18next-browser-languagedetector)
- [x] i18nプロバイダーを実装 (main.tsxで初期化)

### Phase 3: 説明ページを作成（多様な翻訳スタイルPR）
- [x] About/説明ページを作成 (client/src/pages/About.tsx)
- [x] 各スキンのサンプル変換例を表示
- [x] 外国人ユーザー向けのPR文を作成

### Phase 4: トップページに多言語対応を追加
- [x] Home.tsxを多言語対応 (ヘッダー、タイトル、サブタイトル)
- [x] 言語切り替えボタンをHome.tsxに追加
- [x] AboutページへのリンクをHome.tsxに追加
- [ ] Reader.tsxを多言語対応
- [ ] Guide.tsxを多言語対応

### Phase 5: テストとチェックポイント作成
- [x] 各言語で表示を確認 (英語で正常に表示されることを確認)
- [x] チェックポイント作成 (version: 19bb8051)

## 初回訪問ユーザー向けチュートリアル

### Phase 1: チュートリアルコンポーネントの設計
- [x] チュートリアルのステップを設計（記事貼り付け→スキン選択→APIキー入力→変換→結果確認）
- [x] CSSアニメーションのデザインを決定

### Phase 2: インタラクティブなチュートリアルを実装
- [x] Tutorialコンポーネントを作成 (client/src/components/Tutorial.tsx)
- [x] ステップバイステップのガイドを実装 (5ステップ)
- [x] CSSアニメーションを追加 (paste, select, key, transform, result)
- [x] 多言語対応 (i18n.tsに翻訳追加)

### Phase 3: 初回訪問検知とチュートリアル表示ロジックを実装
- [x] 初回訪問検知ロジックを実装（localStorage使用）
- [x] Home.tsxにチュートリアルを統合
- [x] スキップ機能を追加 (Tutorialコンポーネント内に実装済み)

### Phase 4: チェックポイント作成
- [x] チェックポイント作成 (version: 863eee33)

## OGP設定追加

### Phase 1: OGPプレビュー画像作成
- [x] OGP用プレビュー画像を生成（1200x630px推奨）
- [x] 画像をclient/publicに配置

### Phase 2: OGPメタタグ実装
- [x] client/index.htmlにOGPメタタグを追加
- [x] Twitter Card用メタタグを追加
- [x] Facebook用メタタグを追加

### Phase 3: 動作確認
- [x] OGPメタタグが正しく設定されているか確認
- [x] チェックポイント作成 (version: 15e6189b)

## GitHubプッシュと多言語対応強化、新スキン追加

### Phase 1: GitHubにプッシュ
- [x] 現在の変更をGitHubにプッシュ

### Phase 2: 新しいスキンを追加
- [x] ギャル語風スキンを定義して追加
- [x] 敬語過剰風スキンを定義して追加
- [ ] Gemini APIでテストを実行

### Phase 3: Home.tsxを完全多言語対応
- [x] スキン名を多言語対応
- [x] ボタンテキストを多言語対応
- [x] 詳細設定のラベルとプレースホルダーを多言語対応
- [x] エラーメッセージを多言語対応

##### Phase 4: Settings.tsxを多言語対応
- [x] 設定ページのタイトルとラベルを多言語対応
- [x] ボタンテキストを多言語対応
- [x] エラーメッセージを多言語対応応

### Phase 5: テストとチェックポイント作成
- [x] 各言語で表示を確認
- [x] チェックポイント作成 (version: 06a5b164)

## マーケティング・品質改善タスク

### Phase 1: マーケティング素材作成
- [x] X宣伝文を3パターン作成（バズり・ユーザー訴求）
- [x] Manusキャンペーン応募用投稿文を1パターン作成
- [x] 広告画像を3枚生成（特徴・機能・競争優位性訴求）
- [x] ロゴ画像を1枚生成
- [x] ファビコン画像を作成してHTMLに組み込み
- [x] フッターに製作者情報と寄付情報を追加

### Phase 2: コード品質改善
- [x] コードレビュー実施（設計・例外処理・セキュリティ・パフォーマンス・保守性）
- [x] 優先度S・Aの問題をリファクタ（計画書作成）
- [x] E2Eテストコード生成（正常系・異常系）
- [x] GitHub Actions CI設定ファイル生成

### Phase 3: リスク分析と長期保守
- [x] 5年運用を前提とした3大リスク分析と対策提案
- [x] 使用ライブラリの調査（最新版差分・脆弱性・非推奨API）
- [x] 高トラフィック時のボトルネック分析と回避策
- [x] 障害時の監視設計（ログ・メトリクス・アラート）
- [x] 中長期保守ロードマップ作成作成（短期・中期・長期）

## UI改善とセキュリティ強化

### Phase 1: UI改善
- [x] キャッチコピーを二段構成に変更（上段: 「言葉を着せ替え、表現を楽しむ」、下段: 「同じ内容、違う世界。文体マジック」）
- [x] ヘッダー左上を「言い回しを学ぼう」→「言い回しを楽しもう！」に変更
- [x] 多言語切替えの左側に「使い方」ボタンを追加してGuideページへリンク
- [x] 全体の文言を見直し（「記事を変換」→「テキストを変換」に統一）

### Phase 2: 優先度Sのセキュリティ修正
- [x] APIキー管理の改善（データベースから取得、クライアント送信を廃止）
- [x] レート制限の実装（1日100回制限）
- [x] タイムアウト設定の追加（30秒）
- [x] XSS対策の実装（DOMPurify導入）
- [x] CSRF対策の実装（SameSite Cookie設定）
- [x] 使い方ボタンのスタイルを他のボタンと統一
- [x] 動作確認とチェックポイント作成

## エラーハンドリング改善

### Phase 1: エラーメッセージとリトライ機能
- [x] エラーメッセージの翻訳を追加（タイムアウト、レート制限）
- [x] Home.tsxにエラーハンドリングとリトライボタンを実装
- [x] レート制限状況の表示を追加（残り変換回数）
- [x] 動作確認とチェックポイント作成 (version: c7781e3f)

## スキンプレビュー機能

### Phase 1: ツールチッププレビュー
- [x] 各スキンの変換例を定義（shared/skins.tsに追加）
- [x] Home.tsxにツールチッププレビュー機能を実装
- [x] 動作確認とチェックポイント作成 (version: 4c9dbb2d)

## Xシェア機能

### Phase 1: Xシェアボタン実装
- [x] Reader.tsxにXシェアボタンを追加（既に実装済み）
- [x] シェア時のテキストフォーマットを改善（スキン名 + 変換結果 + ハッシュタグ + URL）
- [x] 動作確認とチェックポイント作成 (version: 48ea39c8)

## カスタムスキン機能

### Phase 1: データベースとバックエンド
- [x] データベーススキーマにcustom_skinsテーブルを追加
- [x] カスタムスキン用のtRPC手続きを実装（作成・取得・更新・削除）

### Phase 2: フロントエンド
- [x] カスタムスキン管理ページを作成（CustomSkins.tsx）
- [x] Home.tsxにカスタムスキンを統合（デフォルトスキンと一緒に表示）
- [x] カスタムスキン作成・編集フォームを実装
- [x] server/transform.tsでカスタムスキンのプロンプトを処理

### Phase 3: テストと完成
- [x] 動作確認とチェックポイント作成 (version: 1a4d70b5)

## 英語表記スキン名の日本語化

### Phase 1: i18n修正
- [x] skin.cryptic_code → エンジニア風
- [x] skin.philo_lecture → ロジカル政治家風
- [x] skin.aphorism → 哲学名言風
- [x] skin.speech_poem → 熱血演説風
- [x] skin.debate_politico → 定量分析政治家風
- [x] 動作確認とチェックポイント作成 (version: 8dfd0ea1)

## APIキー取得方法の追加

### Phase 1: Settings.tsx修正
- [x] Settings.tsxのAPIキー入力欄にGemini APIキー取得方法を追加
- [x] 動作確認とチェックポイント作成 (version: a578c4ce)

## カスタムスキンテンプレート機能

### Phase 1: テンプレートデータ構造設計・実装
- [x] テンプレートデータ型定義を作成（名前、説明、プロンプト、カテゴリ）
- [x] 人気テンプレート10種類を実装
  - [x] ツンデレ風
  - [x] 博多弁風
  - [x] 京都弁風
  - [x] 東北弁風
  - [x] ビジネスメール風
  - [x] ミステリー小説風
  - [x] ファンタジー小説風
  - [x] Twitter投稿風
  - [x] Instagram投稿風
  - [x] YouTuber風

### Phase 2: UI実装
- [x] CustomSkins.tsxにテンプレート選択セクションを追加
- [x] テンプレートカードコンポーネントを作成
- [x] テンプレートからカスタムスキン作成機能を実装
- [x] カテゴリフィルター機能を追加

### Phase 3: 多言語対応
- [x] i18n.tsにテンプレート関連の翻訳を追加（日本語・英語・中国語）
- [x] 各テンプレートの名前と説明を多言語化（skinTemplates.tsで実装済み）

### Phase 4: 動作確認
- [x] テンプレート一覧表示の確認
- [x] テンプレートからカスタムスキン作成の確認
- [x] 多言語切替の確認
- [x] チェックポイント作成 (template-feature-test-results.mdに動作確認結果を記録)

## UX/UI心理学に基づく全面改善

### デザインシステム刷新
- [x] カラーパレットの再設計（より洗練された配色）
- [x] タイポグラフィの最適化（Google Fonts導入）
- [x] アイコンシステムの統一（lucide-reactで統一済み）

### フェーズ1: 高優先度改善
- [x] スキン選択UIの再設計
  - [x] カテゴリタブ導入（方言/キャラクター/ジャンル/SNS）
  - [x] おすすめスキン3つを最上部に固定表示
  - [x] 人気順ソート機能（バッジで表示）
- [x] CTAボタンの最適化
  - [x] サイズ拡大（1.5倍）
  - [x] 色変更（オレンジ×ピンクグラデーション）
  - [x] パルスアニメーション
- [x] ピーク体験の強化
  - [x] 変換完了時のアニメーション（紙吹雪）
  - [x] 共有ボタンの強調（トーストで表示）
  - [x] 次のアクション提案（トーストで表示）

### フェーズ2: 中優先度改善
- [x] 視覚的階層の強化
  - [x] ステップ番号追加（プログレスインジケーター）
  - [x] 人気スキンバッジ（おすすめセクション）
  - [x] 社会的証明（バッジで表示）
- [x] 労働の錠覚演出
  - [x] 変換プロセスの可視化（ローディング表示）
  - [x] 段階的プログレスバー（ステップインジケーター）
  - [x] 完了アニメーション強化（紙吹雪）

### フェーズ3: 低優先度改善
- [x] 即座のフィードバック（0.4秒以内）（ホバーアニメーション）
- [x] デフォルト設定（推奨スキン事前選択 - kansai_banter）
- [x] プログレスインジケーター（ステップ 1-2-3）
- [x] カウンター配置最適化（グラデーションカードで表示）

## ヘッダーナビゲーション改善

### 問題点
- [x] ボタンの配置が不均等で見にくい
- [x] 情報の優先順位が不明確
- [x] "Back to Top"の位置が不適切

### 改善内容
- [x] ヘッダーレイアウトを再設計（左・中・右の3分割）
- [x] ボタンのグループ化と視覚的階層を明確化
- [x] レスポンシブ対応の改善（モバイルでは中央ナビ非表示）

## ヘッダー致命的問題の修正

### 問題点
- [x] トップ画面に「Back to Top」ボタンが表示されている（不要）
- [x] 謎の英語エラーメッセージが表示されている
- [x] 設定ボタンが半分隠れている

### 修正内容
- [x] トップ画面では「Back to Top」を削除
- [x] エラーメッセージを修正（i18nにcustomSkinsキーを追加）
- [x] ヘッダーレイアウトを調整して全ボタンが見えるように

## 緊急修正 - ヘッダー・翻訳・説明

### 問題点
- [x] ヘッダーが右寄りでバランスが悪い
- [x] 詳細設定の項目が英語のまま（temperatureDescription、topPDescription等）
- [ ] 多言語翻訳が一部しか機能していない
- [x] 使い方の説明が不足している（チュートリアルとフッターに存在）

## 🐛 変換機能のバグ修正

### 問題点
- [x] 変換ボタン押下時に結果が表示されない（クラッカーアニメーションのみ）
- [x] 変換結果を表示するUIが実装されていない（変換は成功するが結果が見えない）
- [x] エラーハンドリングが不足している

### 修正内容
- [x] ヘッダーを中央配置に変更してバランスを改善
- [x] i18nに詳細設定の全項目の翻訳を追加
- [x] 使い方説明を復元（appDescription、creator、contact、donationの翻訳を追加）
- [ ] 多言語翻訳の動作確認

## 多言語翻訳の完全化

### 問題点
- [ ] スキン名が英語のまま（Kansai Dialect、Detached Literary等）
- [ ] 中国語でエラーメッセージ「key 'customSkins (zh)' returned an object instead of string.」が表示
- [ ] 英語・中国語の翻訳が不完全

### 修正内容
- [x] 英語翻訳を完全化（全キーを追加）
- [x] 中国語翻訳を完全化（全キーを追加）
- [x] スキン名・説明の英語・中国語翻訳を追加（skinTemplates.tsで実装済み）
- [x] 詳細設定の英語・中国語翻訳を追加

## スキン名・説明の多言語翻訳修正

### 問題点
- [x] 英語でスキン名が英語のまま（Kansai Dialect、Detached Literary等）
- [x] 中国語でスキン名と説明が混在（タイトルは中国語だが説明が日本語）

### 修正内容
- [x] i18n.tsにスキン名と説明の翻訳を追加（英語・中国語・日本語）
- [x] Home.tsxでスキン説明も翻訳キーを使用するように修正
- [x] ブラウザで英語・中国語表示を確認（ユーザーに確認依頼）

## 5つのスキンの翻訳が不足

### 問題点
- [x] skin.aphorism（哲学名言風）の翻訳が不足
- [x] skin.cryptic_code（エンジニア風）の翻訳が不足
- [x] skin.philo_lecture（ロジカル政治家風）の翻訳が不足
- [x] skin.debate_politico（定量分析政治家風）の翻訳が不足
- [x] skin.speech_poem（熱血演説風）の翻訳が不足

### 修正内容
- [x] i18n.tsに5つのスキンの名前と説明の翻訳を追加（日本語・英語・中国語）

## ヘッダー固定表示機能

### 問題点
- [x] スクロール時にヘッダーが一緒にスクロールしてしまう

### 修正内容
- [x] Home.tsxのヘッダーにposition: fixedを適用
- [x] メインコンテンツにpt-24を追加してヘッダーの高さ分オフセット
- [x] z-50を設定してヘッダーが常に最前面に表示されるように

## ヘッダーの翻訳キー表示問題

### 問題点
- [x] ヘッダーに「customSkinsButton」という翻訳キーが表示されている

### 修正内容
- [x] i18n.tsの日本語にcustomSkinsButtonキーを追加

## 詳細設定スライダーの最大値エラー

### 問題点
- [x] temperature: 最大値2を超えている（現在130.0） - スライダーはmax=2.0で正しい
- [x] topP: 最大値1を超えている（現在90.00） - スライダーはmax=1.0で正しい
- [x] lengthRatio: 最大値1.6を超えている（現在100.0x）
### 修正内容
- [x] Home.tsxのスライダーの最大値を正しく設定
  - [x] temperature: max=2（既に正しい）
  - [x] topP: max=1（既に正しい）
  - [x] lengthRatio: max=1.6（max=2.0から1.6に修正）

## スライダー値が正しく送信されない問題（修正完了）

### 問題点
- [x] temperature: 値が100倍されて送信される（例: 1.3 → 130）
- [x] topP: 値が100倍されて送信される（例: 0.9 → 90）
- [x] lengthRatio: 値が100倍されて送信される（例: 1.0 → 100）
- [x] maxOutputTokens: デフォルト値が220で小さすぎる

### 修正内容
- [x] server/db.tsのgetUserSettings関数で値を100で割って正規化
- [x] drizzle/schema.tsのdefaultMaxTokensのデフォルト値を220から1500に修正
- [x] データベーススキーマの変更を適用（pnpm db:push）

### 原因
データベーススキーマで、小数値を整数型（int）で保存するために100倍して保存していたが、取得時に100で割る処理が抜けていた。

## APIキーが保存されない問題

### 問題点
- [ ] Settings.tsxでAPIキーを入力して「設定を保存」しても保存されない
- [ ] 変換時に「APIキーが設定されていません」というエラーが出る

### 調査内容
- [x] Settings.tsxのhandleSave関数を確認
- [x] server/routers.tsのsettings.update procedureを確認
- [x] server/db.tsのupsertUserSettings関数を確認
- [x] データベースに実際に保存されているか確認（複数レコードが保存されている問題を発見）
- [x] getUserSettings関数がAPIキーを正しく返しているか確認（最初のレコードを返しているため、APIキーがnull）

### 修正内容
- [x] Settings.tsxで空のAPIキーを送信しないように修正
- [x] upsertUserSettingsでundefinedのフィールドを除外
- [x] デバッグログを追加
- [x] user_settingsテーブルにuserI dのユニーク制約を追加
- [x] 重複レコードを削除（最新のレコードのみ残す）
- [x] データベーススキーマの変更を適用（pnpm db:push）
- [x] 動作確認

## 変換結果と履歴の問題

### 問題点
- [ ] 変換結果が短い（文字数が足りていない）
- [ ] 共有ボタンが表示されていない
- [ ] 履歴の「元記事」ボタンをクリックしても何も表示されない

### 調査内容
- [x] Home.tsxの変換結果表示部分を確認（トーストで200文字のみ表示）
- [ ] 共有ボタンのコードが存在するか確認
- [ ] History.tsxの「元記事」ボタンの実装を確認
- [x] lengthRatioが正しく機能しているか確認（システムプロンプトを改善）

### 修正内容
- [x] lengthRatioの範囲を0.5～1.5に変更（-50%～+50%）
- [x] システムプロンプトでlengthRatioの指示を明確化
- [x] maxOutputTokensの最大値を2000から8000に変更
- [x] maxOutputTokensのデフォルト値を1500から4000に変更
- [x] データベーススキーマの変更を適用
- [x] 変換結果表示モーダルを追加
- [x] 共有ボタンを追加（Xで共有）
- [x] コピーボタンを追加
- [x] 履歴の「元記事」ボタンを修正（モーダルで元テキストを表示）

## 変換結果と履歴の問題（追加修正）

### 問題点
- [x] 変換結果が途切れて全て見れない（「[NEWSSKINS]」で途切れている）
- [x] 変換履歴の「元記事」ボタンが機能していない
- [x] 「NewsSkins」を「AI言い換えメーカー」に変更

### 修正内容
- [x] transform_historyテーブルにextractedとoutputカラムを追加
- [x] server/routers.tsでextractedとoutputを保存
- [x] History.tsxに「変換結果を見る」ボタンを追加
- [x] 履歴の元記事ボタンの動作を確認（extractedを表示）
- [x] アプリ名を「AI言い換えメーカー」に変更（server/routers.ts、Home.tsx）

## UI表示の修正

### 問題点
- [ ] カスタムスキンページで翻訳キーが表示されている（customSkins.templates.titleなど）
- [ ] トップ画面のアプリ名が「⭐️言い換えメーカー」になっている（「AI言い換えメーカー」に変更）
- [ ] フッターの文言を変更

### 修正内容
- [x] カスタムスキンページの翻訳キーを修正（customSkins → customSkinsDetail）
- [x] i18n.tsのappTitleを「AI言い換えメーカー」に変更
- [x] i18n.tsのappDescriptionを「ワンタップで言葉は変身。スタイルも、あなたの印象も、自在にカスタマイズ。言葉を鍛える、個性を放つ。唯一無二の自分スラング表現工房。」に変更

## お気に入りスキンのドラッグ&ドロップ並び替え機能

- [x] データベーススキーマにorder_indexカラムを追加（favorite_skinsテーブル）
- [x] @dnd-kit/coreと@dnd-kit/sortableをインストール
- [x] 並び替えAPIを実装（favorites.reorder procedure）
- [x] Home.tsxにドラッグ&ドロップUIを実装
- [x] お気に入りスキンがorder_index順に表示されることを確認
- [x] ドラッグ&ドロップで並び順が保存されることを確認
- [x] Vitestテストを作成して実行（4/4テスト成功）

## SNS共有機能の拡張（FacebookとLinkedIn）

- [x] Reader.tsxにFacebook共有ボタンを追加
- [x] Reader.tsxにLinkedIn共有ボタンを追加
- [x] 共有テキストにサイトURLを含める
- [x] 動作確認とチェックポイント作成

## シンプル化：不要機能削除、アプリ名変更、多言語対応完全化

- [x] SNS共有機能拡張のチェックポイント作成
- [x] Settings.tsxファイルを削除
- [x] CustomSkins.tsxファイルを削除
- [x] History.tsxファイルを削除
- [x] お気に入りスキン機能を削除
- [x] ヘッダーから不要ボタンを削除（設定、カスタムスキン、履歴）
- [x] App.tsxから不要ルートを削除
- [x] ヘッダーをシンプルに再配置（使い方、言語切替のみ）
- [x] トップ画面にAPIキー入力欄を追加（localStorage保存）
- [x] Gemini APIキー取得ガイドリンクを追加
- [x] アプリ名を「AIスラングメーカー」に変更（全ファイル）
- [x] シェアURLを https://slang-maker.manus.space に統一
- [x] 多言語翻訳の徹底確認：スキン名（全13種類）
- [x] 多言語翻訳の徹底確認：スキン説明文
- [x] 多言語翻訳の徹底確認：UI要素すべて
- [x] 多言語翻訳の徹底確認：エラーメッセージ
- [x] 最終チェックポイント作成

## 中国語翻訳追加と使い方ページ多言語対応

- [x] i18n.tsに中国語（zh）の翻訳を追加
- [x] スキン名の中国語翻訳（全13種類）
- [x] スキン説明文の中国語翻訳
- [x] UI要素の中国語翻訳
- [x] 使い方ページ（Guide.tsx）を多言語対応
- [ ] 動作確認とチェックポイント作成


## 🐛 共有機能のバグ修正

### 問題点
- [ ] 共有ボタンクリック時にsourceUrlの検証エラーが発生（Invalid URL）
- [ ] Home.tsxでsessionStorageに保存する際、urlフィールドが空文字列になっている

### 修正内容
- [x] ヘッダーを左寄せに変更（justify-start）
- [x] 詳細設定の翻訳を追加（temperature, topP, maxTokens, summaryRatio）

## ソーシャルメディアボタンのレイアウト修正

### 問題点
- [x] ソーシャルメディアボタンが画面からはみ出している（PC・スマホ両方）
- [x] 「共有」ボタンと「変換結果」ラベルが不要

### 修正内容
- [x] 「共有」ボタンを削除
- [x] 「変換結果」ラベルを削除
- [x] ボタンを左詰めに配置（flex-wrap対応）
- [x] スマホでも正しく表示されるように調整
- [x] 「[NEWSSKINS]」→「[スラングメーカー]」に変更

## コード品質改善とリファクタ

### Phase 1: ルーター分割
- [x] server/routers.tsを機能ごとに9ファイルに分割
  - [x] auth.router.ts（認証関連）
  - [x] transform.router.ts（変換機能）
  - [x] settings.router.ts（ユーザー設定）
  - [x] history.router.ts（変換履歴）
  - [x] share.router.ts（共有機能）
  - [x] feedback.router.ts（フィードバック）
  - [x] favorites.router.ts（お気に入りスキン）
  - [x] customSkins.router.ts（カスタムスキン）
  - [x] rateLimit.router.ts（レート制限）
  - [x] index.ts（メインルーター）

### Phase 2: LLM API改善
- [x] リトライロジック実装（Exponential Backoff + Jitter）
- [x] タイムアウト機能追加（30秒）
- [x] 詳細なログ出力

### Phase 3: セキュリティ強化
- [x] XSS対策（DOMPurify - 既に実装済み）
- [x] レート制限強化（分単位 + 日単位）
- [x] インメモリキャッシュ（Sliding Window方式）

### Phase 4: マジックナンバーの定数化
- [x] shared/constants.tsを作成
- [x] 全ファイルで定数を使用

### Phase 5: 不要コード削除
- [x] ComponentShowcase.tsxを削除
- [x] CORS設定の確認

### Phase 6: E2Eテスト・CI・リスク分析
- [x] E2Eテストコード生成（Playwright）
- [x] GitHub Actions CI設定（既に存在）
- [x] ライブラリ脆弱性調査（4件検出）
- [x] ボトルネック予測（4箇所特定）
- [x] 5年運用リスク分析（総予算1億8,758万円）
- [x] 監視設計とアーキテクチャ改善ロードマップ作成

## 最終チェックポイント作成
- [x] 最終チェックポイント作成

## 短縮URL自動生成とワンクリックサンプル変換機能

### 短縮URL自動生成
- [ ] 変換完了時に自動で短縮URLを生成
- [ ] 生成した短縮URLをクリップボードに自動コピー
- [ ] トースト通知で「短縮URLをコピーしました」と表示

### ワンクリックサンプル変換
- [ ] サンプルテキスト1: 経済ニュース × 関西弁
- [ ] サンプルテキスト2: 政治ニュース × Z世代スラング
- [ ] サンプルテキスト3: 社会ニュース × ラップ風
- [ ] トップページにサンプルボタンを3つ配置
- [ ] ボタンクリックで自動的にテキスト入力とスキン選択、変換実行


## 最終機能実装（Phase 1-4）

### Phase 1: 変換履歴（ローカルストレージ）
- [x] データ構造の設計と型定義作成
- [x] localStorage操作用のユーティリティ関数作成
- [x] Home.tsxで変換成功時に履歴を保存
- [x] History.tsxコンポーネント作成（履歴一覧表示）
- [x] 履歴から再表示機能の実装
- [x] ヘッダーに履歴ボタン追加
- [ ] モバイル表示確認
- [ ] チェックポイント作成

### Phase 2: 変換前後の比較表示（教育的価値）
- [x] Reader.tsxに「原文と比較」ボタン追加
- [x] 2カラムレイアウトコンポーネント作成
- [x] レスポンシブ対応（モバイルは縦並び）
- [x] 比較表示のスタイリング
- [ ] モバイル表示確認
- [ ] チェックポイント作成

### Phase 3: スキン比較モード（2カラム）
- [x] Home.tsxに「比較モード」トグル追加
- [x] 比較モード時の2つのスキン選択UI実装
- [x] 2つの変換を並行実行する処理実装
- [x] CompareReader.tsxコンポーネント作成
- [x] エラーハンドリング強化
- [x] 履歴に比較モードデータ保存
- [ ] モバイル表示確認
- [ ] チェックポイント作成

### Phase 4: 匿名統計の表示（コミュニティ感醸成）
- [x] データベースに統計テーブル追加（または既存テーブルから集計）
- [x] tRPCに統計取得API追加
- [x] Home.tsxまたはフッターに統計表示セクション追加
- [x] 統計データのキャッシュ実装
- [ ] モバイル表示確認
- [ ] チェックポイント作成

### Phase 5: 全機能の統合テストと最終チェックポイント
- [x] 全機能の動作確認（デスクトップ）
- [x] 全機能の動作確認（モバイル）
- [x] 既存機能の動作確認（ワンクリックサンプル、短縮URL等）
- [x] TypeScriptエラー確認
- [x] 最終チェックポイント作成


## クリップボードエラー修正

### 問題
- [ ] /readerページで自動短縮URL生成時にクリップボード権限エラーが発生

### 修正内容
- [ ] Home.tsxの自動短縮URL生成処理のエラーハンドリング改善
- [ ] クリップボードアクセス権限チェックを追加
- [ ] 権限がない場合でも処理を続行できるように修正
- [ ] ユーザーに適切なフィードバックを提供

### テスト
- [ ] 修正後の動作確認
- [ ] チェックポイント作成


## ログインなしカスタムスキン実装（ローカルストレージ版）

### Phase 1: ローカルストレージユーティリティ
- [ ] customSkin.ts型定義作成
- [ ] localStorageユーティリティ関数作成（保存・読み込み・削除）

### Phase 2: カスタムスキン作成モーダル
- [ ] CreateCustomSkinModal.tsx実装
- [ ] プロンプト入力フォーム
- [ ] 保存・キャンセル機能

### Phase 3: Home.tsxの拡張
- [ ] スキン選択にカスタムスキンセクション追加
- [ ] 「カスタムスキン作成」ボタン追加
- [ ] カスタムスキンの選択・削除機能

### Phase 4: テストと完成
- [ ] 動作確認
- [ ] チェックポイント作成

## Phase 6: 画像化・ダウンロード機能 (Image Generation & Download)

### 技術調査・設計
- [x] Canvas/HTML2Canvas/dom-to-imageなどのライブラリ調査
- [x] html-to-imageを選定（html2canvasより71倍高速、依存関係なし）
- [x] 日本語フォント対応の調査（システムフォント使用）
- [x] 長文テキストのレンダリング戦略設計（800文字で切り捨て、フォントサイズ自動調整）
- [x] SNS投稿用テンプレートのデザイン設計（1200x630px、2カラムレイアウト）
- [x] エラーハンドリング戦略の設計（メモリ不足、タイムアウト対応）

### 実装
- [x] html-to-imageライブラリのインストール
- [x] ImageGeneratorコンポーネントの作成
- [x] 変換前後のテキストを2カラムでレンダリング
- [x] 長文対応（自動折り返し、800文字で切り捨て、フォントサイズ自動調整）
- [x] SNS投稿用テンプレート（ロゴ、スキン名、URL）
- [x] PNG/JPGダウンロード機能
- [x] Reader.tsxへの統合（画像化ボタン追加、Dialogで表示）
- [x] エラーハンドリング（メモリ不足、タイムアウト、一般エラー）
- [x] 多言語対応（日本語・英語・中国語の翻訳追加）

### テスト
- [x] 短文テスト（88文字）→ 成功
- [x] UI表示テスト → 成功（Dialog、プレビュー、ボタンすべて正常）
- [x] 日本語フォントテスト → 成功
- [x] 2カラムレイアウトテスト → 成功
- [ ] PNG/JPEGダウンロード実行テスト
- [ ] 中文テスト（500文字）
- [ ] 長文テスト（2000文字以上）
- [ ] モバイルブラウザテスト

## Phase 8: ヘッダー・フッター改善（2025-01-09）

### ヘッダー改善
- [x] トップ画面のヘッダーにX（Twitter）共有ボタンを追加
- [x] トップ画面のヘッダーにLINE共有ボタンを追加
- [x] 共有ボタンのデザイン（アイコン＋テキスト）
- [x] 共有時のテキスト（アプリ紹介＋URL）

### フッター改善
- [x] 製作者情報を追加（製作者: @kojima920）
- [x] 問い合わせ先を追加（mk19830920@gmail.com）
- [x] 寄付先を追加（PayPayID: kojima1459）
- [x] 寄付メッセージを追加（★寄付頂けると励みになる為、より良いアプリ開発の為にご寄付を★）
- [x] コピーライトを追加（© 2025 AIスラングメーカー. All rights reserved.）
- [x] Made with ❤️ for public health awarenessを追加
- [x] Made with Manusを追加

### 多言語対応
- [x] フッター情報の英語翻訳を追加
- [x] フッター情報の中国語翻訳を追加

### テスト
- [x] ブラウザでヘッダーボタンの動作確認
- [x] ブラウザでフッター表示の確認
- [x] 多言語切り替えの確認

## Phase 9: FAQセクション追加とブラウザテスト（2025-01-09）

### FAQページ作成
- [x] FAQページコンポーネントを作成（client/src/pages/FAQ.tsx）
- [x] よくある質問の内容を追加（APIキー取得方法、使い方のコツなど）
- [x] App.tsxにFAQページのルーティングを追加
- [x] ヘッダーにFAQへのリンクを追加

### ブラウザテスト: PNG/JPEGダウンロード機能
- [ ] ブラウザでテキストを変換
- [ ] PNGボタンをクリックして画像が正常にダウンロードされるか確認
- [ ] JPEGボタンをクリックして画像が正常にダウンロードされるか確認
- [ ] ダウンロードされた画像の品質を確認

### ブラウザテスト: 長文テスト（2000文字以上）
- [ ] 2000文字以上のテキストを準備
- [ ] 長文テキストで変換を実行
- [ ] 画像生成が正常に動作するか確認
- [ ] 切り捨て処理が正常に動作するか確認
- [ ] フォントサイズ調整が正常に動作するか確認
- [ ] 画像の見た目を確認（読みやすさ、レイアウト）

### 動作確認
- [ ] すべてのテストケースで実際にエラーが発生しないか確認
- [ ] 問題があれば修正

## Phase 8: ヘッダー・フッター改善（2025-12-09）

### ヘッダー改善
- [x] トップ画面のヘッダーにX（Twitter）共有ボタンを追加
- [x] トップ画面のヘッダーにLINE共有ボタンを追加
- [x] 共有ボタンのデザイン（アイコン+テキスト）
- [x] 共有時のテキスト（アプリ紹介+URL）

### フッター改善
- [x] 製作者情報を追加（製作者: @kojima920）
- [x] 問い合わせ先を追加（mk19830920@gmail.com）
- [x] 寄付先を追加（PayPayID: kojima1459）
- [x] 寄付メッセージを追加（★寄付頂けると励みになる為、より良いアプリ開発の為にご寄付を★）
- [x] コピーライトを追加（© 2025 AIスラングメーカー. All rights reserved.）
- [x] Made with ❤️ for public health awarenessを追加
- [x] Made with Manusを追加

### 多言語対応
- [x] フッター情報の英語翻訳を追加
- [x] フッター情報の中国語翻訳を追加

## Phase 9: FAQセクション追加とブラウザテスト（2025-12-09）

### FAQページ作成
- [x] FAQページコンポーネントを作成（client/src/pages/FAQ.tsx）
- [x] よくある質問の内容を追加（APIキー取得方法、使い方のコツなど）
- [x] App.tsxにFAQページのルーティングを追加
- [x] ヘッダーにFAQへのリンクを追加
- [x] FAQの多言語対応（日本語・英語・中国語）

### ブラウザテスト
- [x] PNG/JPEGダウンロード機能のコード実装確認
- [x] デバッグログの追加
- [ ] 本番環境でのダウンロードテスト（公開後）
- [ ] 2000文字以上の長文テスト（本番環境で）

## Phase 10: 画像化プレビュー改善（2025-12-09）

### 問題点
- [ ] プレビュー画像が小さすぎて文字が読めない
- [ ] 2カラムレイアウトで文字が詰まっている
- [ ] フォントサイズが小さすぎる
- [ ] 背景色とテキスト色のコントラストが弱い

### 改善内容
- [x] プレビュー画像のサイズを拡大（1200px → 1600px幅）
- [x] 1カラムレイアウトに変更（変換前→変換後を縦に並べる）
- [x] フォントサイズを大幅に拡大（text-base → text-2xl）
- [x] 背景色とテキスト色のコントラストを強化
- [x] パディングとマージンを調整して読みやすく
- [ ] ブラウザで動作確認
- [ ] チェックポイント作成

## Phase 11: Xシェア機能修正（2025-12-09）

### 問題点
- [ ] ハッシュタグが不要（#AIスラングメーカー #文体変換 #kansai_banter）
- [ ] URLが短縮URLになっていない
- [ ] スキン名が【kansai_banter】のように表示されている

### 修正内容
- [x] ハッシュタグを全て削除
- [x] URLを短縮URL（https://iikae-maker.manus.space）に変更
- [x] スキン名表示を「AIスラングメーカーで変換しました！」に統一
- [ ] ブラウザでXシェア機能をテスト
- [ ] チェックポイント作成
